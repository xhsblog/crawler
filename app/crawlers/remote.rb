require 'faraday'
require 'typhoeus'
require 'typhoeus/adapters/faraday'

class Remote
  def initialize(url = 'http://gzsx.cooco.net.cn/testpage/1/')
    # @cookie = 'QS_ED=1; QS_BK=b6174fb4-1c52-4186-a1d0-a79ec6087045; QS_GD=1; remind_check=1; jyean=M8hXOxsveBp9RPE9My_hsH73o0brF6XVewgJw5hE6pC76roQLlS3-aEO7L4-L9mFLMKCSzwncj2y366tS9YEgtKIZ59xWwguedEEFVenj81d_pDpVSj_sDPFcdE-RA7_0; LF_Email=youedu@xyh.com; jy=50EB9E4336188B76D695E538EF8413AC0E3DC52FA7F91CAAF2EB742BA358F1F7248679689E5E5E23B4E6ECDE25889C065DC7AA9D7714BC6EB48CB85FC358CBFBD290E766C4118518DE9701FC46CD98A32789521DDD624D4896D95A80202F46489932CD96A8A72A5D59576B8F3B92CE737FACB37413EFFC52BC33B6487D5D125750E8089521D32EEE79FFA8A6CE9B808BC0ECD6489675ED8E8D10681484DDAD2CA412B643D8D26D0408CAF4A2FBDBD38C08A21D46675212850AD17C1076FD0375620139A793B26CE4EADA2184B8EBFCD250D7FEDC1F3990A30068786ADAE32FEF691F0C5E04A66FBD89516F8633A4F0797CA7A3D5387D8182D3B3AFA189126C21BC71B07D62FBAAFAF0666C314139D407AB915A3F1804F58B34EA4A6916FB85D8AD94C4D9552C600BDA6F202D64682715B30FD834D759F21B2F620D44C932AF0EC9A1804685012194D9DF590B9B49FCAC3D5689CA2A3682F6DF2907E5EBE0EA39DAD7102B7FA879C41FD5F7F058977A39; jye_cur_sub=math2; jy_user_lbs_math2=; UM_distinctid=16bfdc7b602363-0d2104b9426b11-37667e02-1aeaa0-16bfdc7b603b47; CNZZDATA2018550=cnzz_eid%3D1015546964-1563327918-http%253A%252F%252Fwww.jyeoo.com%252F%26ntime%3D1563368040'
    @conn = Faraday.new(url: url) do |faraday|
      faraday.request :url_encoded
      faraday.adapter :typhoeus
    end
  end

  def get
    # conn = Faraday.new(url: url) do |faraday|
    #   faraday.request :url_encoded
    #   faraday.adapter :typhoeus
    # end
    response = @conn.get do |req|
      req.headers = {
        # 'Cookie' => @cookie
      }
    end
    html = response.body
    # html = @conn.get.body
    # puts "HTML IS #{html}"
    # Nokogiri::HTML.parse html.to_s#.force_encoding('gb2312')
    html
  end

  def post
    # cookie = 'QS_ED=1; QS_BK=b6174fb4-1c52-4186-a1d0-a79ec6087045; QS_GD=1; remind_check=1; remind_check=1; jyean=M8hXOxsveBp9RPE9My_hsH73o0brF6XVewgJw5hE6pC76roQLlS3-aEO7L4-L9mFLMKCSzwncj2y366tS9YEgtKIZ59xWwguedEEFVenj81d_pDpVSj_sDPFcdE-RA7_0; LF_Email=youedu@xyh.com; jy=50EB9E4336188B76D695E538EF8413AC0E3DC52FA7F91CAAF2EB742BA358F1F7248679689E5E5E23B4E6ECDE25889C065DC7AA9D7714BC6EB48CB85FC358CBFBD290E766C4118518DE9701FC46CD98A32789521DDD624D4896D95A80202F46489932CD96A8A72A5D59576B8F3B92CE737FACB37413EFFC52BC33B6487D5D125750E8089521D32EEE79FFA8A6CE9B808BC0ECD6489675ED8E8D10681484DDAD2CA412B643D8D26D0408CAF4A2FBDBD38C08A21D46675212850AD17C1076FD0375620139A793B26CE4EADA2184B8EBFCD250D7FEDC1F3990A30068786ADAE32FEF691F0C5E04A66FBD89516F8633A4F0797CA7A3D5387D8182D3B3AFA189126C21BC71B07D62FBAAFAF0666C314139D407AB915A3F1804F58B34EA4A6916FB85D8AD94C4D9552C600BDA6F202D64682715B30FD834D759F21B2F620D44C932AF0EC9A1804685012194D9DF590B9B49FCAC3D5689CA2A3682F6DF2907E5EBE0EA39DAD7102B7FA879C41FD5F7F058977A39; jye_cur_sub=math2; jy_user_lbs_math2=; UM_distinctid=16bfdc7b602363-0d2104b9426b11-37667e02-1aeaa0-16bfdc7b603b47; CNZZDATA2018550=cnzz_eid%3D1015546964-1563327918-http%253A%252F%252Fwww.jyeoo.com%252F%26ntime%3D1563368040'
    response = @conn.post do |req|
      req.headers = { 
        # 'cookie' => set_cookie(cookie), 
        'user-agent' => 'Mac Safari',
        'Host' => 'www.jyeoo.com'
      }
    end
    response
  end

  private
  def set_cookie(cookie)
    cookies = {
      QS_BK: 'b6174fb4-1c52-4186-a1d0-a79ec6087045',
      CNZZDATA2018550: 'cnzz_eid%3D1015546964-1563327918-http%253A%252F%252Fwww.jyeoo.com%252F%26ntime%3D1563368040',
      jye_cur_sub: 'math2',
      jy_user_lbs_math2: '',
      remind_check: 1,
      QS_ED: 1,
      QS_GD: 1,
      LF_Email: 'youedu@xyh.com',
      UM_distinctid: '16bfdc7b602363-0d2104b9426b11-37667e02-1aeaa0-16bfdc7b603b47',
      jy: '50EB9E4336188B76D695E538EF8413AC0E3DC52FA7F91CAAF2EB742BA358F1F7248679689E5E5E23B4E6ECDE25889C065DC7AA9D7714BC6EB48CB85FC358CBFBD290E766C4118518DE9701FC46CD98A32789521DDD624D4896D95A80202F46489932CD96A8A72A5D59576B8F3B92CE737FACB37413EFFC52BC33B6487D5D125750E8089521D32EEE79FFA8A6CE9B808BC0ECD6489675ED8E8D10681484DDAD2CA412B643D8D26D0408CAF4A2FBDBD38C08A21D46675212850AD17C1076FD0375620139A793B26CE4EADA2184B8EBFCD250D7FEDC1F3990A30068786ADAE32FEF691F0C5E04A66FBD89516F8633A4F0797CA7A3D5387D8182D3B3AFA189126C21BC71B07D62FBAAFAF0666C314139D407AB915A3F1804F58B34EA4A6916FB85D8AD94C4D9552C600BDA6F202D64682715B30FD834D759F21B2F620D44C932AF0EC9A1804685012194D9DF590B9B49FCAC3D5689CA2A3682F6DF2907E5EBE0EA39DAD7102B7FA879C41FD5F7F058977A39',

    }
    
    ID_TYPES.map do |key, value|
      HTTP::Cookie.new(key, value,
      domain:     'http://www.jyeoo.com',
      for_domain: true,
      path:       '/').set_cookie_value
    end
    HTTP::Cookie.new("Cookie", cookie,
      domain:     'http://www.jyeoo.com',
      for_domain: true,
      path:       '/').set_cookie_value
    
  end
end
